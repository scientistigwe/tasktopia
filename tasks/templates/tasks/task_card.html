{% load static %}
{% load i18n %}

{% comment %}
task_card.html should display each task in a Bootstrap card format.
It displays the task title, truncated description, dates, priority, status,
and a checkbox to mark the task as completed.
{% endcomment %}

{% with status_class=task.status|lower %}
<li
    class="card mb-3 {% if status_class == 'overdue' %}border-danger{% elif status_class == 'in progress' %}border-primary{% elif status_class == 'completed' %}border-success{% else %}border-warning{% endif %}">
    <div class="card-body">
        <!-- Task detail -->
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h5
                class="card-title {% if status_class == 'overdue' %}text-danger{% elif status_class == 'in progress' %}text-primary{% elif status_class == 'completed' %}text-success{% else %}text-dark{% endif %} mb-0">
                {{ task.title }}
            </h5>
            <span class="task-detail-icon">
                <a href="{% url 'task_details' task.pk %}">
                    <img src="{% static 'tasks/img/task-detail.png' %}" alt="Task details" width="20" height="20">
                </a>
            </span>
        </div>
        <!-- Description -->
        <p
            class="card-text mb-1 {% if status_class == 'overdue' %}text-danger{% elif status_class == 'in progress' %}text-primary{% elif status_class == 'completed' %}text-success{% else %}text-muted{% endif %}">
            {{ task.description|truncatechars:30 }}
        </p>
        <!-- Start and Due date -->
        <div class="row mb-2">
            <div class="col-6">
                <small class="text-muted">Start: {{ task.start_date|date:"M d, Y" }}</small>
            </div>
            <div class="col-6">
                <small class="text-muted">Due: {{ task.due_date|date:"M d, Y" }}</small>
            </div>
        </div>
        <!-- Priority and Category -->
        <div class="row mb-2">
            <div class="col-6">
                <span class="badge bg-secondary">{{ task.get_priority_display }}</span>
            </div>
            <div class="col-6">
                <small class="text-muted">Category: {{ task.category }}</small>
            </div>
        </div>
        <!-- Status and Completion Switch -->
        <div class="row align-items-center">
            <div class="col-md-6">
                {% if status_class == 'in progress' %}
                <small class="text-primary">In progress</small>
                {% elif status_class == 'completed' %}
                <small class="text-success">Completed: {{ task.completion_date|date:"M d, Y" }}</small>
                {% elif status_class == 'pending' %}
                <small class="text-muted">Pending</small>
                {% elif status_class == 'overdue' %}
                <small class="text-danger">Overdue</small>
                {% endif %}
            </div>
            <div class="col-md-6">
                <form id="completeTaskForm{{ task.id }}" action="{% url 'mark_completed' task.pk %}" method="post"
                    class="form-inline" data-status="{{ task.status }}" data-start-date="{{ task.start_date }}"
                    data-due-date="{{ task.due_date }}">
                    {% csrf_token %}
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="cSwitch{{ task.id }}" name="completed"
                            data-status="{{ task.status }}" data-start-date="{{ task.start_date }}"
                            data-due-date="{{ task.due_date }}">
                        {% if task.status == 'completed' %}checked{% endif %}
                        <label class="form-check-label" for="cSwitch{{ task.id }}">Mark as Completed</label>
                    </div>
                </form>
            </div>
        </div>
    </div>
</li>
{% endwith %}